#!/bin/bash

# create .ssh folder if missing
if [ ! -d ~/.ssh ]; then
    echo Creating the ~/.ssh directory for SSH client configuration...
    mkdir ~/.ssh
else
    echo The ~/.ssh directory for SSH client configuration already exists.
fi

# create config file
echo Appending SSH connection configuration to ~/.ssh/config
cat << EOF >> ~/.ssh/config
################################################################################################
# oneAPI DevCloud SSH config
################################################################################################
Host devcloud
User u224145
IdentityFile ~/.ssh/devcloud-access-key-224145.txt
ProxyCommand ssh -T -i ~/.ssh/devcloud-access-key-224145.txt guest@ssh.devcloud.intel.com

Host devcloud.proxy
User u224145
Port 4022
IdentityFile ~/.ssh/devcloud-access-key-224145.txt
ProxyCommand ssh -T devcloud-via-proxy

# If you must route outgoing SSH connection via a corporate proxy,
# replace PROXY_HOSTNAME and PORT below with the values provided by
# your network administrator.
Host devcloud-via-proxy
User guest
Hostname ssh.devcloud.intel.com
IdentityFile ~/.ssh/devcloud-access-key-224145.txt
LocalForward 4022 c009:22
ProxyCommand nc -x PROXY_HOSTNAME:PORT %h %p
################################################################################################

################################################################################################
# DevCloud VSCode config
################################################################################################
Host devcloud-vscode
UserKnownHostsFile /dev/null
StrictHostKeyChecking no
Hostname localhost
User u224145
Port 5022
IdentityFile ~/.ssh/devcloud-access-key-224145.txt
################################################################################################

################################################################################################
# SSH Tunnel config
################################################################################################
Host *.aidevcloud
User u224145
IdentityFile ~/.ssh/devcloud-access-key-224145.txt
ProxyCommand ssh -T devcloud nc %h %p
LocalForward 5022 localhost:22
LocalForward 5901 localhost:5901
################################################################################################

EOF

# create private key file
echo Creating the private SSH key ~/.ssh/devcloud-access-key-224145.txt
echo Important: this file is your access key, keep it safe like you would a password.
cat << EOF > ~/.ssh/devcloud-access-key-224145.txt
-----BEGIN OPENSSH PRIVATE KEY-----
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
drcZQMosaok9RnAAAAB3UyMjQxNDUBAgM=
-----END OPENSSH PRIVATE KEY-----

EOF

# update permissions to the private key file
chmod 600 ~/.ssh/devcloud-access-key-224145.txt

echo Done! Now you can access Intel DevCloud by running 'ssh devcloud' or, if you are behind a proxy, 'ssh devcloud.proxy'
